!function(t){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=t();else if("function"==typeof define&&define.amd)define([],t);else{("undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this).ACQ=t()}}((function(){return function t(e,n,r){function i(u,c){if(!n[u]){if(!e[u]){var f="function"==typeof require&&require;if(!c&&f)return f(u,!0);if(o)return o(u,!0);var a=new Error("Cannot find module '"+u+"'");throw a.code="MODULE_NOT_FOUND",a}var s=n[u]={exports:{}};e[u][0].call(s.exports,(function(t){return i(e[u][1][t]||t)}),s,s.exports,t,e,n,r)}return n[u].exports}for(var o="function"==typeof require&&require,u=0;u<r.length;u++)i(r[u]);return i}({1:[function(t,e,n){var r=t("./cache"),i=t("./concurrency"),o=t("./timeout"),u=t("./container");function c(t,e){return t&&e?function(n){return e(t(n))}:t||e}n.queueFactory=function(t){var e=t||{},n=e.cache,u=e.concurrency,f=e.negativeCache,a=e.storage,s=e.timeout,l=e.timeoutFallback,h=null;return s&&(h=c(h,o.timeoutFactory(s,l))),u&&(h=c(h,i.concurrencyFactory(u))),(n||f||a)&&(h=c(h,r.cacheFactory(t))),h||(h=function(t){return function(e){return Promise.resolve(e).then(t)}}),function(t){return h(t)}},n.clearCache=function(){u.clearContainers()}},{"./cache":2,"./concurrency":3,"./container":4,"./timeout":8}],2:[function(t,e,n){var r=t("./data-storage"),i=t("./timed-storage"),o=t("./container");function u(t,e){return t>0||e>0?o.objectFactory((function(){return new i.TimedStorage(t,e)})):t<0?o.objectFactory((function(){return new r.SimpleStorage})):void 0}n.cacheFactory=function(t){var e=t.cache,n=t.hasher,r=t.maxItems,i=t.negativeCache,c=t.refresh,f=t.storage;if(e=+e||0,i=+i||0,(c=+c||0)<0)throw new Error("Invalid refresh: "+c);if(null==n&&(n=function(t){return JSON.stringify(t)}),"function"!=typeof n)throw new Error("Invalid hasher: "+n);return function(t){var a=o.objectFactory((function(){return{}})),s=u(e,r),l=u(i,r);return function(e){var r=n(e),i=a();return function(){var t=i[r]||s&&s().get(r)||l&&l().get(r);if(!t)return i[r]=o();c&&Date.now()>t.refresh&&(delete t.refresh,o());return t}().value;function o(){var t={value:f?Promise.resolve().then((function(){return f.get(r)})).then((function(t){return null!=t?t:u().then((function(t){return null==t?t:Promise.resolve().then((function(){return f.set(r,t)})).then((function(){return t}))}))})):u()};return c>0&&(t.refresh=Date.now()+c),t.value.then((function(){if(s)return s().set(r,t)}),(function(){if(l)return l().set(r,t)})).then((function(){c>0&&(t.refresh=Date.now()+c),delete i[r]})),t}function u(){return Promise.resolve(e).then(t)}}}}},{"./container":4,"./data-storage":5,"./timed-storage":7}],3:[function(t,e,n){n.concurrencyFactory=function(t){if(!(t>0))throw new Error("Invalid concurrency: "+t);return function(e){var n=[],r=0;return function(t){return new Promise((function(o,u){n.push((function(){return r++,Promise.resolve(t).then(e).then(o,u)})),i()}))};function i(){if(!(r>=t)){var e=n.shift();e&&e().then(o,o)}}function o(){r--,i()}}}},{}],4:[function(t,e,n){var r=1;n.clearContainers=function(){r++},n.objectFactory=function(t){var e;return function(){return e&&e[r]||((e={})[r]=t())}}},{}],5:[function(t,e,n){var r=function(){function t(){this.items={}}return t.prototype.get=function(t){return this.items[t]},t.prototype.set=function(t,e){this.items[t]=e},t}();n.SimpleStorage=r},{}],6:[function(t,e,n){var r=function(){function t(){this.last=null,this.items={},this.size=0}return t.prototype.get=function(t){var e=this.items[t];if(e&&e.value)return e},t.prototype.set=function(t,e){var n=e;this.remove(t),this.items[t]=n,this.size++,n.key=t;var r=this.last;r&&(n.next=r.value?r:r.next),this.last=n},t.prototype.limit=function(t){for(var e=this.last;e;){if(0>=t)return void this.truncate(e);e.value&&t--,e=e.next}},t.prototype.remove=function(t){var e,n=this.get(t);if(n)for(n.value&&(delete this.items[n.key],this.size--,n.key=n.value=null);n&&!n.value;)e&&(e.next=n.next),e=n,n=n.next},t.prototype.truncate=function(t){for(;t;){t.value&&(delete this.items[t.key],this.size--,t.key=t.value=null);var e=t.next;t.next=null,t=e}},t.prototype.toArray=function(){for(var t=[],e=this.last;e;)e.value&&t.push(e),e=e.next;return t.reverse()},t}();n.LinkedStorage=r},{}],7:[function(t,e,n){var r=t("./linked-storage"),i=function(){function t(t,e){this.limited=0,this.items=new r.LinkedStorage,this.expires=t>0&&+t||0,this.maxItems=e>0&&+e||0}return t.prototype.get=function(t){var e=this.expires,n=this.items,r=n.get(t);if(r){if(e)if(Date.now()>r.ttl)return void n.truncate(r);return r}},t.prototype.set=function(t,e){var n=e,r=this,i=r.expires,o=r.items,u=r.maxItems,c=Date.now();i&&(n.ttl=c+i),o.set(t,e),u&&u<o.size&&(c<this.limited+u||(this.limited=c,o.limit(u)))},t}();n.TimedStorage=i},{"./linked-storage":6}],8:[function(t,e,n){n.timeoutFactory=function(t,e){if(!(t>0))throw new Error("Invalid timeout: "+t);if(null==e&&(e=function(){return Promise.reject(new Error("timeout: "+t+"ms"))}),"function"!=typeof e)throw new Error("Invalid timeoutFallback: "+e);return function(n){return function(r){return new Promise((function(i,o){var u=0,c=setTimeout((function(){if(c=null,!u++)return Promise.resolve(r).then(e).then(i,o)}),t);Promise.resolve(r).then(n).then((function(t){c&&clearTimeout(c),u++||i(t)}),(function(t){c&&clearTimeout(c),u++||o(t)}))}))}}}},{}]},{},[1])(1)}));