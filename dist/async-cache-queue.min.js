!function(t){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=t();else if("function"==typeof define&&define.amd)define([],t);else{("undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this).ACQ=t()}}((function(){return function t(e,n,r){function o(u,c){if(!n[u]){if(!e[u]){var f="function"==typeof require&&require;if(!c&&f)return f(u,!0);if(i)return i(u,!0);var a=new Error("Cannot find module '"+u+"'");throw a.code="MODULE_NOT_FOUND",a}var s=n[u]={exports:{}};e[u][0].call(s.exports,(function(t){return o(e[u][1][t]||t)}),s,s.exports,t,e,n,r)}return n[u].exports}for(var i="function"==typeof require&&require,u=0;u<r.length;u++)o(r[u]);return o}({1:[function(t,e,n){var r=t("./cache"),o=t("./concurrency"),i=t("./timeout"),u=t("./container");function c(t,e){return t&&e?function(n){return e(t(n))}:t||e}n.queueFactory=function(t){var e=t||{},n=e.cache,u=e.concurrency,f=e.negativeCache,a=e.storage,s=e.timeout,l=e.timeoutFallback,h=null;return s&&(h=c(h,i.timeoutFactory(s,l))),u&&(h=c(h,o.concurrencyFactory(u))),(n||f||a)&&(h=c(h,r.cacheFactory(t))),h||(h=function(t){return function(e){return Promise.resolve().then((function(){return t(e)}))}}),function(t){return h(t)}},n.clearCache=function(){u.clearContainers()}},{"./cache":2,"./concurrency":3,"./container":4,"./timeout":8}],2:[function(t,e,n){var r=t("./data-storage"),o=t("./timed-storage"),i=t("./container");function u(t,e){return t>0||e>0?i.objectFactory((function(){return new o.TimedStorage(t,e)})):t<0?i.objectFactory((function(){return new r.SimpleStorage})):void 0}n.cacheFactory=function(t){var e=t.cache,n=t.hasher,r=t.maxItems,o=t.negativeCache,c=t.refresh,f=t.storage;if(e=+e||0,o=+o||0,(c=+c||0)<0)throw new Error("Invalid refresh: "+c);if(null==n&&(n=function(t){return JSON.stringify(t)}),"function"!=typeof n)throw new Error("Invalid hasher: "+n);return function(t){var a=i.objectFactory((function(){return{}})),s=u(e,r),l=u(o,r);return function(e){var r=n(e),o=a();return function(){var t=o[r]||s&&s().getItem(r)||l&&l().getItem(r);if(!t)return o[r]=i();c&&Date.now()>t.refresh&&(delete t.refresh,i());return t}().value;function i(){var n={value:f?Promise.resolve().then((function(){return f.get(r)})).then((function(n){return null!=n?n:t(e).then((function(t){return null==t?t:Promise.resolve().then((function(){return f.set(r,t)})).then((function(){return t}))}))})):Promise.resolve().then((function(){return t(e)}))};return c>0&&(n.refresh=Date.now()+c),n.value.then((function(){if(s)return s().setItem(r,n)}),(function(){if(l)return l().setItem(r,n)})).then((function(){c>0&&(n.refresh=Date.now()+c),delete o[r]})),n}}}}},{"./container":4,"./data-storage":5,"./timed-storage":7}],3:[function(t,e,n){n.concurrencyFactory=function(t){if(!(t>0))throw new Error("Invalid concurrency: "+t);return function(e){var n=[],r=0;return function(t){return new Promise((function(i,u){n.push((function(){return r++,Promise.resolve().then((function(){return e(t)})).then(i,u)})),o()}))};function o(){if(!(r>=t)){var e=n.shift();e&&e().then(i,i)}}function i(){r--,o()}}}},{}],4:[function(t,e,n){var r=1;n.clearContainers=function(){r++},n.objectFactory=function(t){var e;return function(){return e&&e[r]||((e={})[r]=t())}}},{}],5:[function(t,e,n){var r,o=this&&this.__extends||(r=function(t,e){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])})(t,e)},function(t,e){function n(){this.constructor=t}r(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}),i=function(){function t(){}return t.prototype.get=function(t){var e=this.getItem(t);if(e)return e.value},t.prototype.set=function(t,e){this.setItem(t,{value:e})},t}();n.EnvelopeKVS=i;var u=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.items={},e}return o(e,t),e.prototype.getItem=function(t){return this.items[t]},e.prototype.setItem=function(t,e){this.items[t]=e},e}(i);n.SimpleStorage=u},{}],6:[function(t,e,n){var r,o=this&&this.__extends||(r=function(t,e){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])})(t,e)},function(t,e){function n(){this.constructor=t}r(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}),i=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.latest=null,e.items={},e.length=0,e}return o(e,t),e.prototype.getItem=function(t){var e=this.items[t];if(e&&!e.deleted)return e},e.prototype.setItem=function(t,e){var n=e;this.delete(t),this.items[t]=n,this.length++,n.key=t;var r=this.latest;r&&(n.next=r.deleted?r.next:r),this.latest=n},e.prototype.size=function(){return this.length},e.prototype.shrink=function(t){for(var e=this.latest;e;){if(0>=t)return void this.truncate(e);e.deleted||t--,e=e.next}},e.prototype.delete=function(t){var e=this.getItem(t);e&&this._delete(e)},e.prototype._delete=function(t){var e;if(t)for(t.deleted||(delete this.items[t.key],this.length--,t.key=t.value=null,t.deleted=!0);t&&t.deleted;)e&&(e.next=t.next),e=t,t=t.next},e.prototype.truncate=function(t){for(var e=t;e;)this._delete(e),e=e.next},e.prototype.values=function(){for(var t=[],e=this.latest;e;)e.deleted||t.push(e),e=e.next;return t.reverse()},e}(t("./data-storage").EnvelopeKVS);n.LinkedStorage=i},{"./data-storage":5}],7:[function(t,e,n){var r,o=this&&this.__extends||(r=function(t,e){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])})(t,e)},function(t,e){function n(){this.constructor=t}r(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}),i=t("./data-storage"),u=t("./linked-storage"),c=function(t){function e(e,n){var r=t.call(this)||this;return r.limited=0,r.items=new u.LinkedStorage,r.expires=e>0&&+e||0,r.maxItems=n>0&&+n||0,r}return o(e,t),e.prototype.getItem=function(t){var e=this,n=e.expires,r=e.items,o=e.maxItems,i=r.getItem(t);if(i){if(n)if(Date.now()>i.ttl)return void r.truncate(i);return o&&o<r.size()&&this._checkSize(),i}},e.prototype.setItem=function(t,e){var n=e,r=this,o=r.expires,i=r.items,u=r.maxItems;if(o){var c=Date.now();n.ttl=c+o}i.setItem(t,e),u&&u<i.size()&&this._checkSize()},e.prototype._checkSize=function(){var t=this.items,e=this.maxItems,n=Date.now();n<this.limited+e||(this.limited=n,t.shrink(e))},e}(i.EnvelopeKVS);n.TimedStorage=c},{"./data-storage":5,"./linked-storage":6}],8:[function(t,e,n){n.timeoutFactory=function(t,e){if(!(t>0))throw new Error("Invalid timeout: "+t);if(null==e&&(e=function(){return Promise.reject(new Error("timeout: "+t+"ms"))}),"function"!=typeof e)throw new Error("Invalid timeoutFallback: "+e);return function(n){return function(r){return new Promise((function(o,i){var u=0,c=setTimeout((function(){if(c=null,!u++)return Promise.resolve().then((function(){return e(r)})).then(o,i)}),t);Promise.resolve().then((function(){return n(r)})).then((function(t){c&&clearTimeout(c),u++||o(t)}),(function(t){c&&clearTimeout(c),u++||i(t)}))}))}}}},{}]},{},[1])(1)}));